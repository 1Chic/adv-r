# Preface

Welcome to the 2nd edition of __Advanced R__. This is a comprehensive update which includes a number of sweeping changes as described below.

## Major changes

### Colour

```{r, include = FALSE}
length(fs::dir_ls("diagrams/", glob = "*.png", recursive = TRUE))
```

The 2nd edition has been published in colour, which as well as improving the syntax highlighting of the code chunks, has considerably increased the scope for helpful diagrams. I have taken advantage of this and included many more diagrams throughout the book. There now over 100 diagrams.

### Bookdown



### New packages

A big change since the first edition of the book is the creation of the [rlang](http://rlang.r-lib.org) package, written primarily by my colleague Lionel Henry. The goal of this package is to provide a clean interface to low-level data structures and operations. I use this package in favour of base R because I believe it makes easier to understand how the R language works. Instead of struggling with the incidentals of functions that evolved organically over many years, the more consistent rlang API makes it easier to focus on the big ideas.

In each section, I'll briefly outline the base R equivalents to rlang code. But if you want to see the purest base R expression of these ideas, I recommend reading the first edition of the book, which you can find online at <http://adv-r.had.co.nz>.

Overall, rlang is still a work in progress, and much of the API continues to mature. However, the code used in this book is part of the rlang's testing process and will continue to work in the future. You can also see our confidence in the stability of rlang functions with the lifecycle badges at the documentation.

## Structure

By and large the second edition has considerably expanded coverage of existing material. There were, however, four chapters that didn't make the uct:

* The vocabulary chapter was removed. It was always a bit of an odd duck, and
  think there are more effective ways to present vocabulary lists than a book
  chapter.

* The style chapter has been replaced with an online style guide available
  at <http://style.tidyverse.org/>. The style guide is paired with the new
  [styler][styler] package which can automatically apply many of the rules.

* The chapter of R's C interface has been moved to a new repo that will aim
  to provide more a comprehensive description of writing C code to work with
  R data structures: <https://github.com/hadley/r-internals>. This is still
  a work in progress.

* The memory chapter has been removed. Much of the material has been integrated
  into Chapter \@ref(names-values). The remainder felt excessively technical
  and not that important to understand, so has been removed.

### Foundations

*   Chapter \@ref(names-values), "Names and values", is a brand new chapter 
    that helps you understand the difference between objects and names of 
    objects. This helps you more accurately predict when R will make a copy of 
    a data structure, and lays important ground work for functional programming.

*   Chapter \@ref(vectors-chap), "Vectors" was previously called data 
    structures, and has been rewritten to focus on vector types like integers,
    factors, and data frames. It contains more details of important S3
    vectors, and discusses the tibble data type provided by the tibble
    package.

*   Chapter \@ref(subsetting), "Subsetting", now distinguishes between `[` and
    `[[` by their intention: `[` extracts many values and `[[` extracts a 
    single value (previously they were characterised by whether they "simplified"
    or "preserved"). Section \@ref(subset-single) draws the train to help you
    understand what `[[` does to lists, and introduces the new `purrr::pluck()`
    and `purrr::chuck()` functions which have more consistent behaviour for
    out-of-bounds indices.

*   Chapter \@ref(functions), "Functions", has an improved ordering,
    now introduces the pipe as a third way to compose functions (Section 
    \@ref(function-composition)), and has considerably improved coverage of 
    function forms (Section \@ref(function-forms)).

*   Chapter \@ref(environments), "Environments", has a much improved discussion 
    of frames and how they relate to the call stack. 

*   Chapter \@ref(conditions), "Conditions", contains some material previously 
    in "Exceptions and debugging", and much new content on how R's condition
    system works. The section on defensive programming has been removed, 
    because discussing type stability is more natural in the context of 
    functional programming, and we now know how to safely program with 
    non-standard evaluation.

### Programming paradigms

After foundations, the book has been re-organised around the three most important programming paradigms in R: functional programming, object oriented programming, and metaprogramming.

* The functional programming chapters have been updated to use on the tools 
  provided by the purrr package. The greater consistency in purrr makes 
  it possible to focus more on the underlying ideas without being distracted by 
  incidental details. 
  
  Functional programming is now more cleanly divided in to the three main 
  FP techniques: functionals (Chapter \@ref(functionals)), function 
  factories (Chapter \@ref(function-factories)), and function operators
  (Chapter \@ref(function-operators)). I've tried to focus on ideas that have
  practical applications in data science, and reduce the amount of pure theory
  that doesn't have immediate practical benefits. 

* Object oriented programming (OOP) now forms a major section of the book with 
  completely new chapters on base types (Chapter \@ref(base-types)), 
  S3 (Chapter \@ref(s3)), S4 (Chapter \@ref(s4)), R6 (Chapter \@ref(R6)), 
  and the tradeoffs between the systems (Chapter \@ref(oo-tradeoffs)).
  
* Metaprogramming, formerly "computing on the language", describes the suite
  of tools that you can use to generate code with code. Compared to the first 
  edition it has been substantially expanded and now focusses primarily on
  "tidy evaluation", a set of ideas and theory that that make metaprogramming 
  safe, well-principled, and accessible to many more R programmers. 

### Techniques

The final section of the book collects chapters on programming techniques, including debugging, profiling, improving performance, and connecting R and C++.

[styler]: http://styler.r-lib.org/
